#!/usr/bin/env sh

# Helper to quickly open Jira issues or the team board.
# Configured with `JIRA_URL` and `JIRA_TEAM_KEY` environment variables.
#
# Usage examples:
# `jiraopen` - if the current branch has a Jira key in it, will open that 
#              specific key
# `jiraopen` - if the current branch does not have a Jira key, will open the 
#              team board
# `jiraopen KP-123` - explicitly open issue `KP-123` in Jira
# `jiraopen KP` - explicitly open the `KP` project in Jira
jiraopen()
{
    # Check if arguments were passed in
    if [ "x$1" != "x" ]; then
        # An issue nr or board name was passed in
        open "$JIRA_URL/browse/$1"
        return
    fi

    # Get the currently checked out branch
    local branch=`git rev-parse --abbrev-ref HEAD 2> /dev/null`
    # Parse the issue nr. from the branch name
    local issue=`echo $branch | sed -E 's/^([A-Z]{2,6}-[0-9]{1,}).*/\\1/g'`
    if [ "$branch" != "$issue" ]; then
        # Branch contains issue nr., so open that issue
        open "$JIRA_URL/browse/$issue"
    else
        # Branch does not contain issue, so open the team board
        open "$JIRA_URL/browse/$JIRA_TEAM_KEY"
    fi
}

jiraopen $1
